---
title: "드리프트 감지"
description: "사용자 입력이 정상 패턴에서 벗어날 때 실시간으로 모니터링합니다."
order: 16
category: VectorWave
---

## 시맨틱 드리프트란?

시간이 지남에 따라 AI 함수가 받는 입력은 변할 수 있습니다 -- 새로운 주제, 다른 표현 패턴, 또는 전혀 새로운 사용 사례가 등장합니다. **시맨틱 드리프트**는 새로운 입력이 검증된 "Golden Dataset"에서 크게 벗어날 때 발생합니다.

이것이 중요한 이유:

- 캐시된 결과가 더 이상 적합하지 않을 수 있습니다
- 익숙하지 않은 입력에 대해 모델 성능이 저하될 수 있습니다
- 테스트하지 않은 엣지 케이스에서 에러가 증가할 수 있습니다

VectorWave의 **드리프트 레이더**가 이를 실시간으로 모니터링합니다.

## 드리프트 감지의 동작 원리

```
New Input → Embedding → KNN Distance Check
                              │
                    ┌─────────┴──────────┐
                    │                     │
           Avg Distance < 0.25    Avg Distance ≥ 0.25
              (범위 내)              (드리프트 감지!)
                    │                     │
                    ▼                     ▼
              정상 실행              웹훅 알림
                                   (Discord/Slack)
```

1. 새로운 입력이 들어오면 VectorWave는 해당 함수의 과거 성공 실행에서 **K-최근접 이웃**을 조회합니다
2. 이 K개 이웃까지의 **평균 거리**를 계산합니다 (기본 K=5, `DRIFT_NEIGHBOR_AMOUNT`로 설정 가능)
3. 평균 거리가 임계값(기본값: 0.25, `DRIFT_DISTANCE_THRESHOLD`로 설정 가능)을 초과하면 드리프트 알림이 발생합니다

이 KNN 기반 접근 방식은 단일 중심점 비교보다 더 견고하며, 벡터 공간의 국소 밀도를 고려합니다.

## 설정

환경 변수로 드리프트 감지를 활성화합니다:

```bash
# .env
DRIFT_DETECTION_ENABLED=True
DRIFT_DISTANCE_THRESHOLD=0.25    # 거리 임계값 (기본값: 0.25)
DRIFT_NEIGHBOR_AMOUNT=5          # KNN 검사 이웃 수 (기본값: 5)
```

## 웹훅 알림

드리프트가 감지되면, VectorWave는 웹훅을 통해 실시간 알림을 전송합니다. 환경 변수로 알림을 설정합니다:

```bash
# .env
ALERTER_STRATEGY=webhook
ALERTER_WEBHOOK_URL=https://discord.com/api/webhooks/...
ALERTER_MIN_LEVEL=ERROR
```

알림 페이로드에 포함되는 정보:

- 함수 이름 및 모듈 경로
- 에러 코드 (해당하는 경우)
- 디버깅을 위한 Trace ID
- 캡처된 속성 (입력, 태그)
- 전체 스택 트레이스 (에러로 인한 드리프트인 경우)
- K-최근접 이웃까지의 평균 거리

### 알림 페이로드

```json
{
  "type": "drift_detected",
  "function_name": "generate_response",
  "module_path": "app.ai.generator",
  "distance": 0.34,
  "threshold": 0.25,
  "input_preview": "How do I mine bitcoin...",
  "trace_id": "abc-123",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## 임계값 튜닝

| 임계값 | 민감도 | 사용 사례 |
|---|---|---|
| `0.15` | 매우 민감 | 안전 최우선 애플리케이션 |
| `0.25` | 기본값 | 일반 프로덕션 모니터링 |
| `0.35` | 관대 | 탐색적 / 창의적 애플리케이션 |
| `0.50` | 매우 관대 | 넓은 범위의 함수 |

임계값은 `DRIFT_DISTANCE_THRESHOLD` 환경 변수를 통해 전역적으로 적용됩니다.

## 드리프트 시뮬레이션

**함수를 실제로 실행하지 않고** 입력이 드리프트 알림을 트리거하는지 테스트할 수 있습니다:

```python
from vectorwave import simulate_drift_check

result = simulate_drift_check(
    text="How do I mine bitcoin with my GPU?",
    function_name="generate_response",
    threshold=0.25,   # 선택사항, 기본값은 DRIFT_DISTANCE_THRESHOLD
    k=5,              # 선택사항, 기본값은 DRIFT_NEIGHBOR_AMOUNT
)

print(result)
# { "is_drift": True, "distance": 0.38, "threshold": 0.25, "neighbors": 5 }
```

활용 사례:
- 프로덕션 배포 전 임계값 민감도 테스트
- 안전 레이어에서 사용자 입력 사전 검증
- 커스텀 드리프트 대시보드 구축

> **VectorSurfer**: 드리프트 모니터링은 [VectorSurfer 대시보드](/vectorsurf)에서 시각화됩니다 — 함수별 실시간 드리프트 거리 차트, 알림 이력, 드리프트 시각화.

## 다음 단계

- [Golden Dataset](/docs/vectorwave-golden) -- 드리프트 감지의 기준선 관리
- [리플레이 테스트](/docs/vectorwave-testing) -- Golden Dataset 기반 테스트
- [고급 설정](/docs/vectorwave-advanced) -- 웹훅, 태깅, 아카이빙
