---
title: "드리프트 감지"
description: "사용자 입력이 정상 패턴에서 벗어날 때 실시간으로 모니터링합니다."
order: 15
category: VectorWave
---

## 시맨틱 드리프트란?

시간이 지남에 따라 AI 함수가 받는 입력은 변할 수 있습니다 -- 새로운 주제, 다른 표현 패턴, 또는 전혀 새로운 사용 사례가 등장합니다. **시맨틱 드리프트**는 새로운 입력이 검증된 "Golden Dataset"에서 크게 벗어날 때 발생합니다.

이것이 중요한 이유:

- 캐시된 결과가 더 이상 적합하지 않을 수 있습니다
- 익숙하지 않은 입력에 대해 모델 성능이 저하될 수 있습니다
- 테스트하지 않은 엣지 케이스에서 에러가 증가할 수 있습니다

VectorWave의 **드리프트 레이더**가 이를 실시간으로 모니터링합니다.

## 드리프트 감지의 동작 원리

```
New Input → Embedding → Distance from Golden Centroid
                              │
                    ┌─────────┴──────────┐
                    │                     │
              Distance < 0.25       Distance ≥ 0.25
              (범위 내)              (드리프트 감지!)
                    │                     │
                    ▼                     ▼
              정상 실행              웹훅 알림
                                   (Discord/Slack)
```

1. VectorWave는 각 함수의 모든 Golden Dataset 항목에 대한 **중심점**(평균 벡터)을 유지합니다
2. 새로운 입력이 들어오면 중심점으로부터의 **코사인 거리**를 계산합니다
3. 거리가 임계값(기본값: 0.25)을 초과하면 드리프트 알림이 발생합니다

## Golden Dataset 관리

Golden Dataset은 검증된 고품질 실행의 모음입니다. 드리프트 감지의 기준선 역할을 합니다.

### 실행을 Golden으로 승격

```python
from vectorwave import VectorWaveDatasetManager

dm = VectorWaveDatasetManager()

# 검증된 실행을 Golden 상태로 승격
dm.register_as_golden(
    log_uuid="abc-123",
    note="Verified by QA team",
    tags=["v2", "production"],
)
```

### Golden 후보 자동 추천

VectorWave는 Golden 상태에 적합한 실행을 제안할 수 있습니다:

```python
# 성공률과 다양성 기반으로 추천
candidates = dm.recommend_candidates(
    function_name="generate_response",
    limit=5,
)

for candidate in candidates:
    print(f"UUID: {candidate['uuid']}")
    print(f"Input: {candidate['input_preview']}")
    print(f"Confidence: {candidate['confidence_score']}")
    print("---")
```

### Golden 항목 목록 조회

```python
# 함수의 모든 Golden 항목 조회
golden = dm.get_golden_dataset(
    function_name="generate_response",
)

print(f"Golden dataset size: {len(golden)}")
```

## 웹훅 알림

드리프트가 감지되면, VectorWave는 웹훅을 통해 실시간 알림을 전송합니다.

### Discord 연동

```python
from vectorwave import configure_alerts

configure_alerts(
    webhook_url="https://discord.com/api/webhooks/...",
    drift_threshold=0.25,  # 기본값
)
```

Discord 임베드에 포함되는 정보:

- 함수 이름 및 모듈 경로
- 에러 코드 (해당하는 경우)
- 디버깅을 위한 Trace ID
- 캡처된 속성 (입력, 태그)
- 전체 스택 트레이스 (에러로 인한 드리프트인 경우)
- Golden 중심점으로부터의 거리 값

### 커스텀 웹훅

```python
configure_alerts(
    webhook_url="https://your-api.com/alerts",
    drift_threshold=0.30,
    format="json",  # Discord 임베드 대신 원시 JSON 페이로드
)
```

### 알림 페이로드

```json
{
  "type": "drift_detected",
  "function_name": "generate_response",
  "module_path": "app.ai.generator",
  "distance": 0.34,
  "threshold": 0.25,
  "input_preview": "How do I mine bitcoin...",
  "trace_id": "abc-123",
  "timestamp": "2025-01-15T10:30:00Z"
}
```

## 임계값 튜닝

| 임계값 | 민감도 | 사용 사례 |
|---|---|---|
| `0.15` | 매우 민감 | 안전 최우선 애플리케이션 |
| `0.25` | 기본값 | 일반 프로덕션 모니터링 |
| `0.35` | 관대 | 탐색적 / 창의적 애플리케이션 |
| `0.50` | 매우 관대 | 넓은 범위의 함수 |

### 함수별 임계값

```python
@vectorize(
    auto=True,
    drift_threshold=0.20,  # 기본값보다 엄격
)
def safety_critical_function(query: str):
    ...

@vectorize(
    auto=True,
    drift_threshold=0.40,  # 더 관대
)
def creative_function(query: str):
    ...
```

## VectorSurfer에서 모니터링

[VectorSurfer](/docs/vectorsurf-overview)는 드리프트 모니터링을 위한 시각적 대시보드를 제공합니다:

- 함수별 실시간 드리프트 거리 차트
- Golden Dataset 관리 UI
- 알림 이력 및 추세
- 중심점 시각화

## 다음 단계

- [리플레이 테스트](/docs/vectorwave-testing) -- Golden Dataset 기반 테스트
- [고급 설정](/docs/vectorwave-advanced) -- 웹훅, 태깅, 아카이빙
- [VectorSurfer 대시보드](/docs/vectorsurf-features) -- 시각적 모니터링
